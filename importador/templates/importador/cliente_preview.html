{% extends "importador/base.html" %}

{% block content %}
<div class="row">
 <div class="col-lg-12 mx-auto">
 <div class="d-flex justify-content-between align-items-center mb-4">
 <h2 class="mb-0"><i class="bi bi-people"></i> Preview de Importação - Clientes</h2>
 <a href="{% url 'importador:upload_page' %}" class="btn btn-outline-secondary">
 <i class="bi bi-arrow-left"></i> Voltar
 </a>
 </div>

 <div class="card shadow-sm mb-4">
 <div class="card-header bg-primary text-white">
 <h5 class="mb-0">Dados Extraídos Intelligentemente</h5>
 </div>
 <div class="card-body">
 <div class="alert alert-info d-flex align-items-center">
 <i class="bi bi-info-circle fs-4 me-3"></i>
 <div>
 Foram identificados <strong>{{ total }}</strong> clientes com base na estrutura da sua planilha.
 Os dados foram limpos e formatados automaticamente (CPFs/CNPJs padronizados).
 </div>
 </div>

 <div class="table-responsive">
 <table class="table table-hover align-middle">
 <thead class="table-light">
 <tr>
 <th>Nome/Razão Social</th>
 <th>CPF/CNPJ</th>
 <th>Telefone</th>
 <th>Localização / Endereço</th>
 <th class="text-center">Status</th>
 <th>Contatos Extraídos</th>
 </tr>
 </thead>
 <tbody>
 {% for cliente in preview %}
 <tr>
 <td class="fw-bold">{{ cliente.nome }}</td>
 <td><code>{{ cliente.cpf_cnpj|default:"-" }}</code></td>
 <td>{{ cliente.telefone|default:"-" }}</td>
 <td>
 <small class="text-muted d-block" style="max-width: 250px;">
 {{ cliente.endereco|default:"Não informado" }}
 </small>
 </td>
 <td class="text-center">
 {% if cliente.status == 'ATIVO' %}
 <span class="badge bg-success">ATIVO</span>
 {% elif cliente.status == 'INATIVO' %}
 <span class="badge bg-danger">INATIVO</span>
 {% else %}
 <span class="badge bg-secondary">{{ cliente.status|default:"-" }}</span>
 {% endif %}
 </td>
 <td>
 {% if cliente.contato_nome %}
 <div class="small">
 <i class="bi bi-person h6 mb-0"></i> <strong>{{ cliente.contato_nome }}</strong><br>
 <i class="bi bi-telephone text-muted"></i> {{ cliente.contato_telefone|default:"-" }}<br>
 <i class="bi bi-envelope text-muted"></i> {{ cliente.contato_email|default:"-" }}
 </div>
 {% else %}
 <span class="text-muted small">Nenhum</span>
 {% endif %}
 </td>
 </tr>
 {% empty %}
 <tr>
 <td colspan="6" class="text-center py-5 text-muted">
 <i class="bi bi-exclamation-triangle display-4 d-block mb-3"></i>
 Nenhum dado pôde ser extraído desta planilha. verifique se o formato está correto.
 </td>
 </tr>
 {% endfor %}
 </tbody>
 </table>
 </div>

 {% if preview %}
 <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
 <button class="btn btn-success btn-lg px-5" onclick="confirmarImportacao()">
 <i class="bi bi-cloud-check me-2"></i> Confirmar e Importar Clientes
 </button>
 </div>
 {% endif %}
 </div>
 </div>
 </div>
</div>

<script>
 function confirmarImportacao() {
 if (confirm('Deseja realmente importar estes clientes para o sistema?')) {
 // Esta função será expandida no JavaScript principal para chamar a API real
 alert('Processo de importação iniciado!');
 window.location.href = "{% url 'importador:history_page' %}";
 }
 }
</script>
{% endblock %}