{% extends "importador/base.html" %}

{% block title %}Histórico de Importações - Importador Inteligente{% endblock %}

{% block content %}
<div class="mb-4">
 <h3 class="mb-0">Histórico de Importações</h3>
 <p class="text-muted small">Acompanhe o status e os resultados de todos os arquivos processados</p>
</div>

<div class="card overflow-hidden">
 <div class="table-responsive">
 <table class="table table-hover align-middle mb-0">
 <thead class="bg-light">
 <tr>
 <th>Arquivo</th>
 <th>Template / Módulo</th>
 <th>Status</th>
 <th>Progresso / Resultados</th>
 <th>Data/Hora</th>
 <th class="text-end">Ações</th>
 </tr>
 </thead>
 <tbody>
 {% for job in jobs %}
 <tr>
 <td>
 <div class="fw-bold text-truncate" style="max-width: 200px;"
 title="{{ job.original_filename }}">
 {{ job.original_filename }}
 </div>
 <small class="text-muted">ID: #{{ job.id }}</small>
 </td>
 <td>
 {% if job.template %}
 <div>{{ job.template.name }}</div>
 <span class="badge bg-secondary">{{ job.template.module_type }}</span>
 {% else %}
 <span class="text-muted">Template excluído</span>
 {% endif %}
 </td>
 <td>
 {% if job.status == 'completed' %}
 <span class="badge bg-success"><i class="bi bi-check-circle"></i> Concluído</span>
 {% elif job.status == 'processing' %}
 <span class="badge bg-primary processing"><i class="bi bi-arrow-repeat"></i> Processando</span>
 {% elif job.status == 'pending' %}
 <span class="badge bg-warning text-dark"><i class="bi bi-clock"></i> Pendente</span>
 {% elif job.status == 'error' %}
 <span class="badge bg-danger"><i class="bi bi-exclamation-triangle"></i> Erro</span>
 {% elif job.status == 'cancelled' %}
 <span class="badge bg-secondary"><i class="bi bi-x-circle"></i> Cancelado</span>
 {% endif %}
 </td>
 <td>
 {% if job.status == 'processing' %}
 <div class="progress" style="height: 10px; width: 120px;">
 <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar"
 style="width: {{ job.get_progress_percentage }}%"></div>
 </div>
 <small class="text-muted">{{ job.processed_rows }} / {{ job.total_rows }}</small>
 {% elif job.status == 'completed' %}
 <small class="text-success d-block">
 <i class="bi bi-plus-lg"></i> {{ job.inserted_rows }} inseridos
 </small>
 {% if job.error_rows > 0 %}
 <small class="text-danger">
 <i class="bi bi-x-lg"></i> {{ job.error_rows }} erros
 </small>
 {% endif %}
 {% else %}
 <small class="text-muted">-</small>
 {% endif %}
 </td>
 <td>
 <small>{{ job.created_at|date:"d/m/Y H:i" }}</small>
 </td>
 <td class="text-end">
 <a href="{% url 'importador:detail_page' job.id %}" class="btn btn-sm btn-outline-primary">
 <i class="bi bi-eye"></i> Detalhes
 </a>
 </td>
 </tr>
 {% empty %}
 <tr>
 <td colspan="6" class="text-center py-5">
 <i class="bi bi-cloud-slash display-4 text-muted mb-3 d-block"></i>
 <p class="text-muted">Nenhuma importação realizada ainda.</p>
 <a href="{% url 'importador:upload_page' %}" class="btn btn-sm btn-primary">Iniciar primeiro
 upload</a>
 </td>
 </tr>
 {% endfor %}
 </tbody>
 </table>
 </div>
</div>
{% endblock %}