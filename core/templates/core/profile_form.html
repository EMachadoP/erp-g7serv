{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
 <div class="card shadow-sm">
 <div class="card-header bg-white">
 <h4 class="mb-0">{% if group %}Editar Perfil: {{ group.name }}{% else %}Novo Perfil{% endif %}</h4>
 </div>
 <div class="card-body">
 <form method="post">
 {% csrf_token %}
 <div class="mb-4">
 <label class="form-label">Nome do Perfil</label>
 <input type="text" name="name" class="form-control" value="{{ group.name }}" required>
 </div>

 <h5 class="mb-3">Permiss√µes de Acesso</h5>

 <div class="accordion" id="permissionsAccordion">
 {% for menu in grouped_permissions %}
 <div class="accordion-item">
 <h2 class="accordion-header" id="heading{{ forloop.counter }}">
 <button class="accordion-button {% if not forloop.first %}collapsed{% endif %}"
 type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ forloop.counter }}"
 aria-expanded="{% if forloop.first %}true{% else %}false{% endif %}"
 aria-controls="collapse{{ forloop.counter }}">
 {{ menu.name }}
 </button>
 </h2>
 <div id="collapse{{ forloop.counter }}"
 class="accordion-collapse collapse {% if forloop.first %}show{% endif %}"
 aria-labelledby="heading{{ forloop.counter }}" data-bs-parent="#permissionsAccordion">
 <div class="accordion-body">
 {% for submenu in menu.submenus %}
 <div class="mb-3">
 <h6 class="fw-bold">{{ submenu.name }}</h6>
 <div class="row">
 {% for perm in submenu.perms %}
 <div class="col-md-4">
 <div class="form-check">
 <input class="form-check-input" type="checkbox" name="permissions"
 value="{{ perm.id }}" id="perm{{ perm.id }}" {% if perm.id in current_permissions %}checked{% endif %}>
 <label class="form-check-label" for="perm{{ perm.id }}">
 {{ perm.name }}
 </label>
 </div>
 </div>
 {% endfor %}
 </div>
 </div>
 {% if not forloop.last %}
 <hr>{% endif %}
 {% endfor %}
 </div>
 </div>
 </div>
 {% endfor %}
 </div>

 <div class="d-flex justify-content-end gap-2 mt-4">
 <a href="{% url 'core:profile_list' %}" class="btn btn-secondary">Cancelar</a>
 <button type="submit" class="btn btn-success">Salvar</button>
 </div>
 </form>
 </div>
 </div>
</div>
{% endblock %}