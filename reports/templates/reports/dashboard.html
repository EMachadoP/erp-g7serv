{% extends 'base.html' %}

{% block content %}
<div class="container-fluid mt-4">
 <h2 class="mb-4">Dashboard Gerencial</h2>

 <!-- KPIs -->
 <div class="row mb-4">
 <div class="col-md-3">
 <div class="card text-white bg-success mb-3">
 <div class="card-header">Faturamento (Mês)</div>
 <div class="card-body">
 <h5 class="card-title">R$ {{ monthly_revenue|floatformat:2 }}</h5>
 </div>
 </div>
 </div>
 <div class="col-md-3">
 <div class="card text-white bg-danger mb-3">
 <div class="card-header">Contas a Pagar (Mês)</div>
 <div class="card-body">
 <h5 class="card-title">R$ {{ monthly_expenses|floatformat:2 }}</h5>
 </div>
 </div>
 </div>
 <div class="col-md-3">
 <div class="card text-white bg-primary mb-3">
 <div class="card-header">Contratos Ativos</div>
 <div class="card-body">
 <h5 class="card-title">{{ active_contracts }}</h5>
 </div>
 </div>
 </div>
 <div class="col-md-3">
 <div class="card text-white bg-warning mb-3">
 <div class="card-header">OS em Aberto</div>
 <div class="card-body">
 <h5 class="card-title">{{ open_os }}</h5>
 </div>
 </div>
 </div>
 </div>

 <!-- Chart -->
 <div class="row">
 <div class="col-md-12">
 <div class="card">
 <div class="card-header">
 Receita vs Despesa (Últimos 6 Meses)
 </div>
 <div class="card-body">
 <canvas id="financeChart" width="400" height="150"></canvas>
 </div>
 </div>
 </div>
 </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
 var ctx = document.getElementById('financeChart').getContext('2d');
 var myChart = new Chart(ctx, {
 type: 'bar',
 data: {
 labels: {{ chart_labels| safe }},
 datasets: [{
 label: 'Receita',
 data: {{ revenue_data| safe }},
 backgroundColor: 'rgba(75, 192, 192, 0.2)',
 borderColor: 'rgba(75, 192, 192, 1)',
 borderWidth: 1
 },
 {
 label: 'Despesa',
 data: {{ expense_data| safe }},
 backgroundColor: 'rgba(255, 99, 132, 0.2)',
 borderColor: 'rgba(255, 99, 132, 1)',
 borderWidth: 1
 }]
 },
 options: {
 scales: {
 y: {
 beginAtZero: true
 }
 }
 }
 });
</script>
{% endblock %}