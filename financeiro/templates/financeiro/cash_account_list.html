{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container-fluid mt-4">
 <div class="d-flex justify-content-between align-items-center mb-4">
 <div>
 <h2 class="fw-bold mb-0">Gestão de Caixa</h2>
 <p class="text-muted">Acompanhe seus saldos e contas bancárias</p>
 </div>
 <a href="{% url 'financeiro:cash_account_create' %}" class="btn btn-primary d-flex align-items-center">
 <i class="bi bi-plus-circle me-2"></i> Nova Conta
 </a>
 </div>

 <!-- Resumo dos Saldos -->
 <div class="row mb-4">
 <div class="col-md-4">
 <div class="card border-0 shadow-sm bg-primary text-white h-100">
 <div class="card-body">
 <h6 class="text-uppercase small fw-bold opacity-75">Saldo Total Disponível</h6>
 <h2 class="fw-bold mb-0" id="totalBalance">R$ ...</h2>
 </div>
 </div>
 </div>
 {% for account in accounts %}
 {% if 'cora' in account.name.lower %}
 <div class="col-md-4">
 <div class="card border-0 shadow-sm h-100 border-start border-4 border-info">
 <div class="card-body">
 <div class="d-flex justify-content-between align-items-start">
 <div>
 <h6 class="text-uppercase small fw-bold text-muted">Saldo {{ account.name }}</h6>
 <h3 class="fw-bold mb-0">R$ {{ account.current_balance }}</h3>
 </div>
 <span class="badge bg-info-subtle text-info">Cora</span>
 </div>
 </div>
 </div>
 </div>
 {% endif %}
 {% endfor %}
 </div>

 <!-- Lista de Contas -->
 <div class="card border-0 shadow-sm">
 <div class="card-header bg-white py-3">
 <h5 class="mb-0 fw-bold">Minhas Contas</h5>
 </div>
 <div class="table table-responsive">
 <table class="table table-premium table-hover align-middle mb-0">
 <thead class="bg-light">
 <tr>
 <th class="ps-4">Nome da Conta</th>
 <th>Banco</th>
 <th>Agência/Conta</th>
 <th>Saldo Atual</th>
 <th class="text-end pe-4">Ações</th>
 </tr>
 </thead>
 <tbody>
 {% for account in accounts %}
 <tr>
 <td class="ps-4">
 <div class="d-flex align-items-center">
 <div class="bg-primary bg-opacity-10 text-primary rounded p-2 me-3">
 <i class="bi bi-bank fs-5"></i>
 </div>
 <span class="fw-bold">{{ account.name }}</span>
 </div>
 </td>
 <td>{{ account.bank_name|default:"-" }}</td>
 <td>{{ account.agency|default:"" }} / {{ account.account_number|default:"" }}</td>
 <td><span
 class="fw-bold text-{% if account.current_balance >= 0 %}success{% else %}danger{% endif %}">R$
 {{ account.current_balance }}</span></td>
 <td class="text-end pe-4">
 <a href="{% url 'financeiro:financial_statement' %}?account={{ account.id }}"
 class="btn btn-sm btn-outline-primary me-2">
 <i class="bi bi-list-columns-reverse"></i> Extrato
 </a>
 <a href="{% url 'financeiro:cash_account_update' account.id %}"
 class="btn btn-sm btn-light">
 <i class="bi bi-pencil"></i>
 </a>
 </td>
 </tr>
 {% empty %}
 <tr>
 <td colspan="5" class="text-center py-5 text-muted">Nenhuma conta cadastrada.</td>
 </tr>
 {% endfor %}
 </tbody>
 </table>
 </div>
 </div>
</div>

<script>
 document.addEventListener('DOMContentLoaded', function () {
 let total = 0;
 {% for account in accounts %}
 total += parseFloat("{{ account.current_balance|stringformat:'.2f' }}");
 {% endfor %}
 document.getElementById('totalBalance').textContent = 'R$ ' + total.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
 });
</script>
{% endblock %}